<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Daniel J. Harvey - My First Haskell Project - Part 1</title>
    <link rel="stylesheet" href="../css/default.css" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RKDYZB38Z0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-RKDYZB38Z0');
    </script>
</head>

<body>
    <header>
        <div class="logo">
            <a href="../">Daniel J. Harvey</a>
        </div>
        <nav>
            <a href="../">Home</a>
            <a href="../contact.html">Contact</a>
            <a href="../archive.html">Archive</a>
        </nav>
    </header>

    <main role="main">
        <h1>My First Haskell Project - Part 1</h1>
        <article>
    <section class="header">
        Posted on December 26, 2018
        
        <div class="info">
          
          Tags: <a title="All pages tagged 'haskell'." href="../tags/haskell.html" rel="tag">haskell</a>, <a title="All pages tagged 'stack'." href="../tags/stack.html" rel="tag">stack</a>
          
        </div>
    </section>
    <section>
        <p>I have not always found it clear how to get started with Haskell, and I have a small library I want to make as an experiment so I figured I’d document the process as a sort of Getting Started. The tiny library I wish to make is for reading environment variables, which can be used for database connections or similar. I use MacOS but will try not to make anything too platform specific, and link to docs where info for other systems can be found where possible.</p>
<p>First, let’s assume we have nothing Haskell-based on the system whatsoever, and start by installing Stack.</p>
<p>On MacOS this is as easy as running</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install stack</span></code></pre></div>
<p>but for other systems you will need to look at the <a href="https://docs.haskellstack.org/en/stable/install_and_upgrade/">Stack docs</a>.</p>
<p>Assuming that’s all gone swimmingly, let’s start a new project, which we will call <code>simple-env</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> new simple-env</span></code></pre></div>
<p>This will create a new folder called <code>simple-env</code> containing the following:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">.gitignore</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ChangeLog.md</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">LICENSE</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">README.md</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Setup.hs</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">app</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ex">package.yaml</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="ex">simple-env.cabal</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="ex">src</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="ex">stack.yaml</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="bu">test</span></span></code></pre></div>
<p>Looks great. There are two files here that describe our project… <code>simple-env.cabal</code> generated by Cabal, and <code>package.yaml</code> generated by Stack. Don’t make the mistake I made and change the Cabal one directly - instead use <code>package.yaml</code> as the source of truth and allow Stack to auto-generate sensible <code>.cabal</code> files.</p>
<p>Here is our default <code>package.yaml</code> file:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> simple-env</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.1.0.0</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">github</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;githubuser/simple-env&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">license</span><span class="kw">:</span><span class="at"> BSD3</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Author name here&quot;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">maintainer</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;example@example.com&quot;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">copyright</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;2018 Author name here&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">extra-source-files</span><span class="kw">:</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> README.md</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> ChangeLog.md</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Metadata used when publishing your package</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># synopsis:            Short description of your package</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># category:            Web</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># To avoid duplicated efforts in documentation and dealing with the</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># complications of embedding Haddock markup inside cabal files, it is</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># common to point users to the README.md file.</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="fu">description</span><span class="kw">:</span><span class="at"> Please see the README on GitHub at &lt;https://github.com/githubuser/simple-env</span><span class="co">#readme&gt;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> base &gt;= 4.7 &amp;&amp; &lt; 5</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span><span class="kw">:</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at"> src</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="fu">executables</span><span class="kw">:</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">simple-env-exe</span><span class="kw">:</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">main</span><span class="kw">:</span><span class="at"> Main.hs</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at"> app</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ghc-options</span><span class="kw">:</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> -threaded</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> -rtsopts</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> -with-rtsopts=-N</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> simple-env</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="fu">tests</span><span class="kw">:</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">simple-env-test</span><span class="kw">:</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">main</span><span class="kw">:</span><span class="at"> Spec.hs</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at"> test</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ghc-options</span><span class="kw">:</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> -threaded</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> -rtsopts</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> -with-rtsopts=-N</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> simple-env</span></span></code></pre></div>
<p>If you’re familar with the Javascript world, this isn’t a million miles away from a <code>package.json</code> file.</p>
<p>We aren’t going to need any new libraries for our project, but it seems sensible to explain how that’s done. Let’s install <a href="http://hackage.haskell.org/package/contravariant-1.5/docs/Data-Functor-Contravariant.html">contravariant</a> package, because why not.</p>
<p>Let’s add it to here:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> base &gt;= 4.7 &amp;&amp; &lt; 5</span></span></code></pre></div>
<p>so we have</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> base &gt;= 4.7 &amp;&amp; &lt; 5</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> contravariant</span></span></code></pre></div>
<p>We don’t mind what version in this case - Stack will choose us a sensible one that fits with our other dependencies, that’s what it’s for.</p>
<p>Let’s run</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> build</span></code></pre></div>
<p>and watch the action.</p>
<p>The first time you run this on any given project, Stack will download the GHC compiler and all the libraries so you may wish to take a break and go and read War and Peace or something. After the initial wait subsequent builds will be very quick, but this one is a bit of a stinker.</p>
<p>Ok. Great, we have filled our hard drive with nonsense and we are ready to Haskell.</p>
<p>What else have we got in this folder?</p>
<p>Firstly, we have the <code>app</code> folder which contains one file, <code>Main.hs</code>. This is the entry-point to our application, and looks like this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Lib</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> someFunc</span></code></pre></div>
<p>When a Haskell program is run the <code>main</code> function in a module called <code>Main</code> is run, and then it is responsible for everything else that happens. Therefore we can deduce that this program is importing <code>someFunc</code> from somewhere and running that. Seems plausible. Let’s run it and see what happens.</p>
<p>If we look back in <code>package.yaml</code> we have a section that looks like this:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">executables</span><span class="kw">:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">simple-env-exe</span><span class="kw">:</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">main</span><span class="kw">:</span><span class="at"> Main.hs</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">source-dirs</span><span class="kw">:</span><span class="at"> app</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ghc-options</span><span class="kw">:</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> -threaded</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> -rtsopts</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> -with-rtsopts=-N</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> simple-env</span></span></code></pre></div>
<p>What it telling us? Well, a bunch of things, but two that stick out.</p>
<ol type="1">
<li>Firstly, yes, our assumptions were correct - our main source directory is <code>app</code> and the main file is <code>Main.hs</code>.</li>
<li>Secondly, that our executable file is called <code>simple-env-exe</code></li>
</ol>
<p>Let’s run it then!</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> exec simple-env-exe</span></code></pre></div>
<p>It should just print “someFunc” to the screen and exit, which is admittedly quite underwhelming.</p>
<p>We can do better than this.</p>
<p>So it looks like <code>someFunc</code> is a function in <code>src/Lib.hs</code>. The whole file looks like this. Let’s start work in here.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Lib</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    ( someFunc</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    ) <span class="kw">where</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ot">someFunc ::</span> <span class="dt">IO</span> ()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>someFunc <span class="ot">=</span> <span class="fu">putStrLn</span> <span class="st">&quot;someFunc&quot;</span></span></code></pre></div>
<p>Our library is going to extract environment variables so they can be used in programs. This is helpful for stuff like database credentials that we don’t want to save in version control.</p>
<p>Here is the MVP version:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Lib</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    ( someFunc</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    ) <span class="kw">where</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">System.Environment</span> (lookupEnv)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="ot">someFunc ::</span> <span class="dt">IO</span> ()</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>someFunc <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    testValue <span class="ot">&lt;-</span> lookupEnv <span class="st">&quot;TEST_VALUE&quot;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">putStrLn</span> (showResult testValue)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="ot">showResult ::</span> <span class="dt">Maybe</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>showResult maybeValue <span class="ot">=</span> <span class="kw">case</span> maybeValue <span class="kw">of</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Just</span> value <span class="ot">-&gt;</span> <span class="st">&quot;TEST_VALUE&quot;</span> <span class="op">++</span> <span class="st">&quot;: &quot;</span> <span class="op">++</span> value</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    _          <span class="ot">-&gt;</span> <span class="st">&quot;TEST_VALUE could not found!&quot;</span></span></code></pre></div>
<p>Let’s take this apart a bit.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">System.Environment</span> (lookupEnv)</span></code></pre></div>
<p>Firstly, we have an import. We are using the <code>lookupEnv</code> function from System.Environment. If we look in the docs for it in <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/System-Environment.html">Hackage</a> we can see it has the following type signature:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ot">lookupEnv ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> (<span class="dt">Maybe</span> <span class="dt">String</span>)</span></code></pre></div>
<p>This means we need to give it a <code>String</code> (the name of the environment variable we wish to check for) and it will return a <code>Maybe String</code>. This means if it CAN find a <code>String</code> it will return it, if not, it won’t explode or anything, which is handy. However, that <code>Maybe String</code> is wrapped in an <code>IO</code>. What does this mean?</p>
<p>It means that this function needs to do interaction with the outside world, therefore it must also be run from another <code>IO</code> function using <code>bind</code>. Think of <code>IO</code> like the electricity that allows access to side-effects and the outside world. It’s where the problems are most likely to come from, so Haskell forces us to be very explicit about where it is and more importantly, where it isn’t. Our <code>main</code> functions have access to <code>IO</code>, and they must pass the <code>IO</code>-ness to wherever else needs it.</p>
<p>Opinionated note: <code>IO</code> is one of the more complicated parts of Haskell, and it’s somewhat unfortunate for adoption of the language that we have to deal with it in the first lines of any program. I would wager that this is why so many tutorials and books start with hacking in the <code>ghci</code> repl instead, as it saves having to have The IO Chat. I am a firm believer in uncomfortable truths, moreso if they are explained terribly like this, but if you are starting out, feel utterly free just to accept this part is a bit weird, learn to live with it, and come back to in depth later. The <code>IO</code> concept really is quite a good thing, it just presents something of a Learning Kerb.</p>
<p>We also have a helper function called <code>showResult</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ot">showResult ::</span> <span class="dt">Maybe</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>showResult maybeValue <span class="ot">=</span> <span class="kw">case</span> maybeValue <span class="kw">of</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Just</span> value <span class="ot">-&gt;</span> <span class="st">&quot;TEST_VALUE&quot;</span> <span class="op">++</span> <span class="st">&quot;: &quot;</span> <span class="op">++</span> value</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    _          <span class="ot">-&gt;</span> <span class="st">&quot;TEST_VALUE could not found!&quot;</span></span></code></pre></div>
<p>This function just takes our <code>Maybe String</code> and turns it into a <code>String</code> ready for us to print to the console. It uses pattern matching of the <code>maybeValue</code> to display either the result (<code>value</code>) that the environment variable was set to, or a fallback message. Therefore we should get:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>showResult (<span class="dt">Just</span> <span class="st">&quot;horses&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- &quot;TEST_VALUE: horses&quot;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>showResult (<span class="dt">Nothing</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- &quot;TEST_VALUE could not be found!</span></span></code></pre></div>
<p>Pretty OK, huh?</p>
<p>OK, lastly the glue function, <code>someFunc</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ot">someFunc ::</span> <span class="dt">IO</span> ()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>someFunc <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    testValue <span class="ot">&lt;-</span> lookupEnv <span class="st">&quot;TEST_VALUE&quot;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">putStrLn</span> (showResult testValue)</span></code></pre></div>
<p>What’s the deal here? Ok. So firstly, the <code>Do</code> - it says that we’re starting some <code>Do notation</code> which allows us to write in a slightly more imperative style. Like the <code>IO</code> concept in general it’s a bit of a heavy concept to throw at beginners in the first few lines so let’s also make a mental note to just nod and come back to the concept later. Again, it is a pretty neat thing, but confusing to start with.</p>
<p>Moving on, this line is more interesting:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>testValue <span class="ot">&lt;-</span> lookupEnv <span class="st">&quot;TEST_VALUE&quot;</span></span></code></pre></div>
<p>So as discussed earlier, our <code>lookupEnv</code> takes a <code>String</code> (in this case “TEST_VALUE”) and returns <code>Maybe String</code> wrapped in <code>IO</code>. This <code>&lt;-</code> pulls it out of the <code>IO</code> so that in effect, this line is setting <code>testValue</code> to <code>Maybe String</code>. If <code>lookupEnv</code> finds an environment variable called “TEST_VALUE” then <code>testValue</code> will be <code>Just "whatever_the_value_was"</code>, but if it fails, it’ll be <code>Nothing</code>. Note that we were only able to even use the <code>lookupEnv</code> function because <code>someFunc</code> is also an <code>IO</code> function, so in effect we have passed the <code>IO</code> power along to <code>lookupEnv</code> to let it do it’s magic.</p>
<p>Great stuff. We have done a thing. Now let’s tell our wonderful user all about it.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">putStrLn</span> (showResult testValue)</span></code></pre></div>
<p>OK. So this line just takes <code>testValue</code> (a <code>Maybe String</code>), uses <code>showResult</code> to turn it into a nice <code>String</code> that tells us what happened, and then uses <code>putStrLn</code> (put string line) to show it on the screen. <code>putStrLn</code> is another <code>IO</code> action, with this type signature:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">putStrLn</span><span class="ot"> ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</span></code></pre></div>
<p>This means it takes a <code>String</code>, and then returns <code>()</code> (unit, the nothing value) inside an <code>IO</code>. Again, it must be run inside another <code>IO</code> context to get it’s “power”, as such. Also, the fact it returns <code>()</code> is helpful - our <code>someFunc</code> is of type <code>IO ()</code> meaning it should also return nothing, so <code>putStrLn</code> is also doing that for us. Tidy.</p>
<p>Great stuff.</p>
<p>Let’s try our program.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> build</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> exec simple-env-exe</span></code></pre></div>
<p>Assuming you’ve not got an environment variable called “TEST_VALUE” set you should see:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> exec simple-env-exe</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;TEST_VALUE could not found!&quot;</span></span></code></pre></div>
<p>Let’s set one (assuming you’re in Bash or Zsh):</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">TEST_VALUE</span><span class="op">=</span><span class="st">&quot;horses!&quot;</span></span></code></pre></div>
<p>…and run the program again.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">stack</span> exec simple-env-exe</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;TEST_VALUE: horses!&quot;</span></span></code></pre></div>
<p>Great stuff. It’s not much of a library, but it’s a start. Next time we’ll make a nicer API for fetching multiple variables at once so it’s actually a bit more helpful for our users.</p>
<p>Make sense? If not, why not <a href="../contact.html">get in touch</a>?</p>
<p>Further reading:</p>
<p><a href="https://docs.haskellstack.org/en/stable/README/">The Haskell Stack Tool</a></p>
<p><a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/System-Environment.html">System.Environment</a></p>
<p><a href="https://wiki.haskell.org/Introduction_to_Haskell_IO/Actions">Intro to IO</a></p>
<p><a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/System-IO.html">System.IO</a></p>
<p><a href="http://learnyouahaskell.com/input-and-output">Learn You A Haskell: IO</a></p>
    </section>
</article>

    </main>

    <footer>
      <p>Site proudly generated by
      <a href="http://jaspervdj.be/hakyll">Hakyll</a></p>
      <p>Links for nerds:
        <a href="../atom.xml">atom</a>
        <a href="../rss.xml">rss</a></p>

    </footer>
</body>

</html>
